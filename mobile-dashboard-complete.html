<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Misterpips Mobile</title>
    <link rel="stylesheet" href="mobile-clean.css?v=2025">
    <link rel="stylesheet" href="mobile-chat-styles-fix.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00d4ff">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDSDK0NfVSs_VQb3TnrixiJbOpTsmoUMvU",
            authDomain: "misterpips-b71fb.firebaseapp.com",
            databaseURL: "https://misterpips-b71fb-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "misterpips-b71fb",
            storageBucket: "misterpips-b71fb.firebasestorage.app",
            messagingSenderId: "574231126409",
            appId: "1:574231126409:web:b7ed93ac4ea62e247dc158"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('✅ Utilisateur authentifié:', user.email);
            } else {
                console.log('❌ Pas d'utilisateur, redirection...');
                window.location.href = 'index.html';
            }
        });
    </script>
</head>
<body>
    <!-- Header Mobile -->
    <header class="mobile-header">
        <div class="header-top">
            <h1>📱 Misterpips</h1>
            <button id="menuToggle" class="menu-btn">☰</button>
        </div>
        <div class="stats-row">
            <div class="stat-item">
                <span class="stat-value" id="mobileCapital">$1000</span>
                <span class="stat-label">Capital</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="mobileWinRate">0%</span>
                <span class="stat-label">WinRate</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="mobilePnL">$0</span>
                <span class="stat-label">P&L</span>
            </div>
        </div>
    </header>

    <!-- Menu Mobile -->
    <nav id="mobileMenu" class="mobile-menu">
        <div class="menu-header">
            <h3>Menu</h3>
            <button id="closeMenu" class="close-btn">✕</button>
        </div>
        <ul class="menu-list">
            <li><a href="#dashboard" onclick="showSection('dashboard')" ontouchend="showSection('dashboard')">📊 Dashboard</a></li>
            <li><a href="#trades" onclick="showSection('trades')" ontouchend="showSection('trades')">📈 Mes Trades</a></li>
            <li><a href="#calendar" onclick="showSection('calendar')" ontouchend="showSection('calendar')">📅 Calendrier</a></li>
            <li><a href="#objectives" onclick="showSection('objectives')" ontouchend="showSection('objectives')">🎯 Objectifs</a></li>
            <li><a href="#ranking" onclick="showSection('ranking')" ontouchend="showSection('ranking')">🏆 Classement</a></li>
            <li><a href="#settings" onclick="showSection('settings')" ontouchend="showSection('settings')">⚙️ Paramètres</a></li>
            <li><a href="index.html">🚪 Déconnexion</a></li>
        </ul>
    </nav>

    <!-- Contenu Principal -->
    <main class="mobile-main">
        <!-- Section Dashboard -->
        <section id="dashboard" class="section active">
            <div class="section-header">
                <h2>📊 Dashboard</h2>
                <button id="newTradeBtn" class="primary-btn">+ Trade</button>
            </div>
            
            <div class="chart-container">
                <h3>Performance</h3>
                <canvas id="mobilePerformanceChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>WinRate</h3>
                <canvas id="mobileWinRateChart"></canvas>
            </div>
        </section>

        <!-- Section Trades -->
        <section id="trades" class="section">
            <div class="section-header">
                <h2>📈 Mes Trades</h2>
                <button id="addTradeBtn" class="primary-btn">+ Ajouter</button>
            </div>
            
            <div class="trades-list" id="mobileTradesList">
                <!-- Trades générés dynamiquement -->
            </div>
        </section>

        <!-- Section Calendrier -->
        <section id="calendar" class="section">
            <div class="section-header">
                <h2>📅 Calendrier</h2>
                <div class="calendar-nav">
                    <button id="prevMonthMobile">◀</button>
                    <span id="monthYearMobile">Mois</span>
                    <button id="nextMonthMobile">▶</button>
                </div>
            </div>
            
            <div class="mobile-calendar" id="mobileCalendar">
                <!-- Calendrier généré dynamiquement -->
            </div>
        </section>

        <!-- Section Objectifs -->
        <section id="objectives" class="section">
            <div class="section-header">
                <h2>🎯 Objectifs</h2>
            </div>
            
            <div class="objectives-list">
                <div class="objective-card">
                    <div class="objective-header">
                        <span class="objective-icon">☀️</span>
                        <span class="objective-title">Journalier</span>
                        <span class="objective-target" id="mobileDailyTarget">$10</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mobileDailyProgress"></div>
                    </div>
                    <span class="progress-text" id="mobileDailyPercent">0%</span>
                </div>
                
                <div class="objective-card">
                    <div class="objective-header">
                        <span class="objective-icon">📅</span>
                        <span class="objective-title">Hebdomadaire</span>
                        <span class="objective-target" id="mobileWeeklyTarget">$30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mobileWeeklyProgress"></div>
                    </div>
                    <span class="progress-text" id="mobileWeeklyPercent">0%</span>
                </div>
                
                <div class="objective-card">
                    <div class="objective-header">
                        <span class="objective-icon">📊</span>
                        <span class="objective-title">Mensuel</span>
                        <span class="objective-target" id="mobileMonthlyTarget">$150</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mobileMonthlyProgress"></div>
                    </div>
                    <span class="progress-text" id="mobileMonthlyPercent">0%</span>
                </div>
            </div>
        </section>

        <!-- Section Classement -->
        <section id="ranking" class="section">
            <div class="section-header">
                <h2>🏆 Classement VIP</h2>
            </div>
            
            <div class="ranking-list" id="mobileRankingList">
                <!-- Classement généré dynamiquement -->
            </div>
        </section>

        <!-- Section Paramètres -->
        <section id="settings" class="section">
            <div class="section-header">
                <h2>⚙️ Paramètres</h2>
            </div>
            
            <div class="settings-list">
                <div class="setting-item">
                    <label>Capital initial ($)</label>
                    <input type="number" id="mobileCapitalInput" value="1000" min="100" step="10">
                </div>
                
                <div class="setting-item">
                    <label>Objectif journalier ($)</label>
                    <input type="number" id="mobileDailyGoal" value="10" min="1" step="1">
                </div>
                
                <button class="primary-btn" id="saveSettingsBtn">💾 Sauvegarder</button>
            </div>
        </section>
    </main>

    <!-- Modal Trade -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📈 Nouveau Trade</h3>
                <button class="close-modal" id="closeTradeModal">✕</button>
            </div>
            
            <form id="tradeForm" class="trade-form">
                <div class="form-group">
                    <label>Paire</label>
                    <select id="tradePair" required>
                        <option value="">Sélectionner...</option>
                        <option value="EUR/USD">EUR/USD</option>
                        <option value="GBP/USD">GBP/USD</option>
                        <option value="USD/JPY">USD/JPY</option>
                        <option value="AUD/USD">AUD/USD</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Type</label>
                    <select id="tradeType" required>
                        <option value="BUY">🟢 BUY</option>
                        <option value="SELL">🔴 SELL</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Lot Size</label>
                    <input type="number" id="tradeLot" step="0.01" min="0.01" value="0.01" required>
                </div>
                
                <div class="form-group">
                    <label>Prix d'entrée</label>
                    <input type="number" id="tradeEntry" step="0.00001" value="1.0000" required>
                </div>
                
                <div class="form-group">
                    <label>Stop Loss</label>
                    <input type="number" id="tradeStopLoss" step="0.00001" value="0.9950" required>
                </div>
                
                <div class="form-group">
                    <label>Take Profit</label>
                    <input type="number" id="tradeTakeProfit" step="0.00001" value="1.0050" required>
                </div>
                
                <div class="form-group" id="resultGroup" style="display: none;">
                    <label>Résultat ($)</label>
                    <input type="number" id="tradeResult" step="0.01">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="secondary-btn" id="cancelTradeBtn" onclick="closeMobileModal()" ontouchend="closeMobileModal()">Annuler</button>
                    <button type="submit" class="primary-btn" onclick="saveMobileTrade()" ontouchend="saveMobileTrade()">💾 Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Navigation Bottom -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-section="dashboard">
            <span class="nav-icon">📊</span>
            <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-btn" data-section="trades">
            <span class="nav-icon">📈</span>
            <span class="nav-label">Trades</span>
        </button>
        <button class="nav-btn" data-section="calendar">
            <span class="nav-icon">📅</span>
            <span class="nav-label">Calendrier</span>
        </button>
        <button class="nav-btn" data-section="ranking">
            <span class="nav-icon">🏆</span>
            <span class="nav-label">Classement</span>
        </button>
    </nav>

    <!-- Chat Toggle -->
    <div class="mobile-chat-toggle" id="chatToggle">💬</div>

    <!-- Chat Window -->
    <div class="mobile-chat-window" id="chatWindow" style="display: none;">
        <div class="chat-header">
            <h4>💬 Chat VIP</h4>
            <button class="close-btn" onclick="toggleMobileChat()" ontouchend="toggleMobileChat()">✕</button>
        </div>
        <div class="chat-messages" id="mobileMessages">
            <div class="welcome-message">
                <div class="message-author">Misterpips Bot</div>
                <div class="message-text">Bienvenue dans le chat VIP! 🚀</div>
                <div class="message-time">Maintenant</div>
            </div>
        </div>
        <div class="mobile-emoji-panel" id="mobileEmojiPanel" style="display: none;">
            <div class="emoji-grid">
                <span class="emoji-item" onclick="insertEmoji('😀')" ontouchend="insertEmoji('😀')">😀</span>
                <span class="emoji-item" onclick="insertEmoji('😂')" ontouchend="insertEmoji('😂')">😂</span>
                <span class="emoji-item" onclick="insertEmoji('🔥')" ontouchend="insertEmoji('🔥')">🔥</span>
                <span class="emoji-item" onclick="insertEmoji('💪')" ontouchend="insertEmoji('💪')">💪</span>
                <span class="emoji-item" onclick="insertEmoji('👍')" ontouchend="insertEmoji('👍')">👍</span>
                <span class="emoji-item" onclick="insertEmoji('💰')" ontouchend="insertEmoji('💰')">💰</span>
                <span class="emoji-item" onclick="insertEmoji('📈')" ontouchend="insertEmoji('📈')">📈</span>
                <span class="emoji-item" onclick="insertEmoji('🚀')" ontouchend="insertEmoji('🚀')">🚀</span>
            </div>
        </div>
        <div class="chat-input-container">
            <button class="emoji-btn" onclick="toggleEmojiPanel()" ontouchend="toggleEmojiPanel()">😀</button>
            <input type="text" id="mobileMessageInput" placeholder="Tapez votre message..." maxlength="500" onkeypress="if(event.key==='Enter') sendMobileMessage()">
            <button class="send-btn" onclick="sendMobileMessage()" ontouchend="sendMobileMessage()">➤</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="mobile-simple-trades.js"></script>
    <script>
        // Fonctions chat mobile
        function sendMobileMessage() {
            const input = document.getElementById('mobileMessageInput');
            const message = input.value.trim();
            if (message) {
                const messagesContainer = document.getElementById('mobileMessages');
                messagesContainer.innerHTML += `
                    <div class="message-item">
                        <div class="message-author">Vous</div>
                        <div class="message-text">${message}</div>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                input.value = '';
                console.log('📱 Message envoyé:', message);
            }
        }
        
        function toggleEmojiPanel() {
            const panel = document.getElementById('mobileEmojiPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function insertEmoji(emoji) {
            const input = document.getElementById('mobileMessageInput');
            input.value += emoji;
            toggleEmojiPanel();
        }
        
        function toggleMobileChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.style.display = chatWindow.style.display === 'none' ? 'block' : 'none';
        }
        
        function closeMobileModal() {
            document.getElementById('tradeModal').style.display = 'none';
            editingTradeIndex = -1;
            document.querySelector('#tradeModal h3').textContent = 'Nouveau Trade';
            // Reset form
            document.getElementById('tradeForm').reset();
            document.getElementById('tradeEntry').value = '1.0000';
            document.getElementById('tradeStopLoss').value = '0.9950';
            document.getElementById('tradeTakeProfit').value = '1.0050';
        }
        
        // Variables globales
        let mobileTradesData = [];
        let editingTradeIndex = -1;
        let mobileCharts = {};
        
        async function saveMobileTrade() {
            const pair = document.getElementById('tradePair').value;
            const type = document.getElementById('tradeType').value;
            const lot = document.getElementById('tradeLot').value;
            const entry = document.getElementById('tradeEntry').value;
            const sl = document.getElementById('tradeStopLoss').value;
            const tp = document.getElementById('tradeTakeProfit').value;
            const result = document.getElementById('tradeResult').value;
            
            if (!pair || !type || !lot || !entry) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const trade = {
                id: editingTradeIndex >= 0 ? mobileTradesData[editingTradeIndex].id : Date.now(),
                pair, type, lots: parseFloat(lot),
                entry: parseFloat(entry), 
                stopLoss: parseFloat(sl) || 0, 
                takeProfit: parseFloat(tp) || 0,
                pnl: result ? parseFloat(result) : 0,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString(),
                status: result ? 'closed' : 'open'
            };
            
            try {
                // Sauvegarder dans Firebase
                if (window.firebaseDB) {
                    const { ref, set, push } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js');
                    
                    if (editingTradeIndex >= 0) {
                        // Modification
                        await set(ref(window.firebaseDB, `users/mobile_user_fixed/accounts/compte1/trades/${trade.id}`), trade);
                        mobileTradesData[editingTradeIndex] = trade;
                    } else {
                        // Nouveau trade
                        const newRef = await push(ref(window.firebaseDB, 'users/mobile_user_fixed/accounts/compte1/trades'), trade);
                        trade.id = newRef.key;
                        mobileTradesData.push(trade);
                    }
                }
                
                // Mettre à jour l'affichage
                updateMobileTradesList();
                updateMobileStats();
                updateMobileCharts();
                
                closeMobileModal();
                editingTradeIndex = -1;
                alert(editingTradeIndex >= 0 ? 'Trade modifié!' : 'Trade sauvegardé!');
                
            } catch (error) {
                console.error('❌ Erreur sauvegarde:', error);
                // Sauvegarde locale en cas d'erreur
                if (editingTradeIndex >= 0) {
                    mobileTradesData[editingTradeIndex] = trade;
                } else {
                    mobileTradesData.push(trade);
                }
                updateMobileTradesList();
                updateMobileStats();
                updateMobileCharts();
                closeMobileModal();
                editingTradeIndex = -1;
            }
        }
        
        function updateMobileTradesList() {
            const tradesList = document.getElementById('mobileTradesList');
            if (!tradesList) return;
            
            if (mobileTradesData.length === 0) {
                tradesList.innerHTML = '<div class="no-trades">Aucun trade pour le moment</div>';
                return;
            }
            
            let html = '';
            mobileTradesData.forEach((trade, index) => {
                const profitClass = trade.pnl >= 0 ? 'profit' : 'loss';
                const profitIcon = trade.pnl >= 0 ? '🟢' : '🔴';
                
                html += `
                    <div class="trade-item" data-index="${index}">
                        <div class="trade-header">
                            <span class="trade-pair">${trade.pair}</span>
                            <span class="trade-type ${trade.type.toLowerCase()}">${trade.type}</span>
                            <span class="trade-result ${profitClass}">${profitIcon} $${trade.pnl}</span>
                        </div>
                        <div class="trade-details">
                            <div class="trade-info">
                                <span>Lots: ${trade.lots}</span>
                                <span>Entrée: ${trade.entry}</span>
                                <span>Date: ${trade.date}</span>
                            </div>
                            <div class="trade-actions">
                                <button class="edit-btn" onclick="editMobileTrade(${index})">✏️</button>
                                <button class="delete-btn" onclick="deleteMobileTrade(${index})">🗑️</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            tradesList.innerHTML = html;
        }
        
        function editMobileTrade(index) {
            const trade = mobileTradesData[index];
            if (!trade) return;
            
            editingTradeIndex = index;
            
            // Remplir le formulaire
            document.getElementById('tradePair').value = trade.pair;
            document.getElementById('tradeType').value = trade.type;
            document.getElementById('tradeLot').value = trade.lots;
            document.getElementById('tradeEntry').value = trade.entry;
            document.getElementById('tradeStopLoss').value = trade.stopLoss;
            document.getElementById('tradeTakeProfit').value = trade.takeProfit;
            document.getElementById('tradeResult').value = trade.pnl;
            
            // Changer le titre
            document.querySelector('#tradeModal h3').textContent = 'Modifier Trade';
            
            // Ouvrir la modal
            document.getElementById('tradeModal').style.display = 'block';
        }
        
        async function deleteMobileTrade(index) {
            if (!confirm('Supprimer ce trade?')) return;
            
            const trade = mobileTradesData[index];
            
            try {
                // Supprimer de Firebase
                if (window.firebaseDB && trade.id) {
                    const { ref, remove } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js');
                    await remove(ref(window.firebaseDB, `users/mobile_user_fixed/accounts/compte1/trades/${trade.id}`));
                }
                
                // Supprimer localement
                mobileTradesData.splice(index, 1);
                
                // Mettre à jour l'affichage
                updateMobileTradesList();
                updateMobileStats();
                updateMobileCharts();
                
                alert('Trade supprimé!');
                
            } catch (error) {
                console.error('❌ Erreur suppression:', error);
                // Suppression locale en cas d'erreur
                mobileTradesData.splice(index, 1);
                updateMobileTradesList();
                updateMobileStats();
                updateMobileCharts();
            }
        }
        
        function updateMobileStats() {
            const totalPnL = mobileTradesData.reduce((sum, trade) => sum + trade.pnl, 0);
            const winTrades = mobileTradesData.filter(trade => trade.pnl > 0).length;
            const winRate = mobileTradesData.length > 0 ? (winTrades / mobileTradesData.length * 100) : 0;
            
            document.getElementById('mobilePnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('mobileWinRate').textContent = `${winRate.toFixed(1)}%`;
        }
        
        function updateMobileCharts() {
            // Graphique Performance
            const perfCtx = document.getElementById('mobilePerformanceChart');
            if (perfCtx) {
                if (mobileCharts.performance) {
                    mobileCharts.performance.destroy();
                }
                
                let cumulative = 1000; // Capital initial
                const data = [cumulative];
                const labels = ['Début'];
                
                mobileTradesData.forEach((trade, index) => {
                    cumulative += trade.pnl;
                    data.push(cumulative);
                    labels.push(`T${index + 1}`);
                });
                
                mobileCharts.performance = new Chart(perfCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Capital',
                            data: data,
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: false }
                        }
                    }
                });
            }
            
            // Graphique WinRate
            const winCtx = document.getElementById('mobileWinRateChart');
            if (winCtx) {
                if (mobileCharts.winRate) {
                    mobileCharts.winRate.destroy();
                }
                
                const winTrades = mobileTradesData.filter(trade => trade.pnl > 0).length;
                const lossTrades = mobileTradesData.length - winTrades;
                
                mobileCharts.winRate = new Chart(winCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Gains', 'Pertes'],
                        datasets: [{
                            data: [winTrades, lossTrades],
                            backgroundColor: ['#4CAF50', '#f44336']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }
        
        // Charger les trades au démarrage
        async function loadMobileTrades() {
            try {
                if (window.firebaseDB) {
                    const { ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js');
                    const tradesRef = ref(window.firebaseDB, 'users/mobile_user_fixed/accounts/compte1/trades');
                    const snapshot = await get(tradesRef);
                    
                    if (snapshot.exists()) {
                        const trades = snapshot.val();
                        mobileTradesData = Object.entries(trades).map(([id, trade]) => ({ ...trade, id }));
                    }
                }
                
                updateMobileTradesList();
                updateMobileStats();
                updateMobileCharts();
                
            } catch (error) {
                console.error('❌ Erreur chargement trades:', error);
            }
        }
        
        // Exposer les fonctions
        window.editMobileTrade = editMobileTrade;
        window.deleteMobileTrade = deleteMobileTrade;
        
        // Classement mobile simple (sans Firebase)
        setTimeout(() => {
            const rankingContainer = document.getElementById('mobileRankingList');
            if (rankingContainer) {
                rankingContainer.innerHTML = `
                    <div class="ranking-header"><h4>🏆 Classement VIP</h4></div>
                    <div class="ranking-item">
                        <div class="ranking-position">🥇</div>
                        <div class="ranking-info">
                            <div class="trader-name">Mobile User</div>
                            <div class="trader-stats">Trader VIP</div>
                        </div>
                        <div class="ranking-pnl positive">VIP</div>
                    </div>
                `;
                console.log('✅ Classement mobile affiché');
            }
        }, 1000);
        
        // Événements navigation et chat
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation sections
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const section = btn.getAttribute('data-section');
                if (section) {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                        document.getElementById(section)?.classList.add('active');
                        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                        document.getElementById(section)?.classList.add('active');
                        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                }
            });
            
            // Boutons trade
            document.getElementById('newTradeBtn')?.addEventListener('click', () => {
                editingTradeIndex = -1;
                document.querySelector('#tradeModal h3').textContent = 'Nouveau Trade';
                document.getElementById('tradeModal').style.display = 'block';
            });
            document.getElementById('addTradeBtn')?.addEventListener('click', () => {
                editingTradeIndex = -1;
                document.querySelector('#tradeModal h3').textContent = 'Nouveau Trade';
                document.getElementById('tradeModal').style.display = 'block';
            });
            
            // Initialiser la liste des trades
            showMobileTradesList();
            
            // Chat position
            const chatToggle = document.getElementById('chatToggle');
            const chatWindow = document.getElementById('chatWindow');
            
            if (chatToggle) {
                chatToggle.style.position = 'fixed';
                chatToggle.style.right = '20px';
                chatToggle.style.bottom = '90px';
                chatToggle.style.left = 'auto';
                chatToggle.addEventListener('click', toggleMobileChat);
            }
            
            if (chatWindow) {
                chatWindow.style.position = 'fixed';
                chatWindow.style.right = '20px';
                chatWindow.style.bottom = '160px';
                chatWindow.style.left = 'auto';
            }
        });
        
        // Fonction navigation globale
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId)?.classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-section="${sectionId}"]`)?.classList.add('active');
        }
        
        window.showSection = showSection;
    </script>
</body>
</html>